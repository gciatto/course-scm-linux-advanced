<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>System administration with systemd</title>
<meta name="description" content="Practical introduction to systemd">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/course-scm-linux-advanced/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/course-scm-linux-advanced/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/course-scm-linux-advanced/css/custom-theme.min.f8ce39b744487d1a5e0cd5a60f757e03997b8456b7b97d7eeb5bb33ace629bfd.css" id="theme"><link rel="stylesheet" href="/course-scm-linux-advanced/highlight-js/solarized-dark.min.css">
<link rel="stylesheet" href="https://gitcdn.link/repo/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>
<script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
<script src="https://gciatto.github.io/course-scm-linux-advanced//plantuml.js"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="system-administration-with-systemd">System administration with systemd</h1>
<p>Giovanni Ciatto</p>
</section><section>
<h2 id="references">References</h2>
<ul>
<li><a href="https://wiki.archlinux.org/title/Systemd"><code>systemd</code> on ArchLinux Wiki</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal">DigitalOcean‚Äôs tutorial on <code>systemd</code></a></li>
<li><a href="https://www.slideshare.net/slideshow/systemd-46731240/46731240">Lucas Nussbaum‚Äôs tutorial on <code>systemd</code></a></li>
<li><a href="https://zedas.fr/posts/linux-explained-2-init-and-shell/">‚ÄúLinux explained part 2 : Bootloader, Init and Shell‚Äù</a></li>
<li><a href="https://phndiaye.github.io/the-current-state-of-init-systems.html">‚ÄúThe current state of init systems‚Äù</a></li>
<li><a href="https://seb.jambor.dev/posts/systemd-by-example-part-1-minimization/">‚Äúsystemd by example‚Äù</a></li>
<li>Also the English <a href="https://en.wikipedia.org/wiki/Systemd">Wikipedia page on systemd</a> is quite informative</li>
</ul>
</section><section>
<h2 id="what-is-systemd-pt-1">What is <code>systemd</code>? (pt. 1)</h2>
<blockquote>
<p><code>systemd</code> $\approx$ today‚Äôs most common <strong>init system</strong> for Linux systems</p>
</blockquote>
<ul>
<li>but what‚Äôs an <em>init system</em> in the first place?</li>
</ul>
</section><section>
<h2 id="what-happens-when-you-boot-a-linux-system">What happens when you boot a Linux system?</h2>
<h3 id="overview">Overview</h3>
<p><img src="./boot-complex.png" alt=""></p>
</section><section>
<h2 id="what-happens-when-you-boot-a-linux-system-1">What happens when you boot a Linux system?</h2>
<h3 id="the-role-of-the-_init-system_">The role of the <em>init system</em></h3>

<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><p><img src="./boot-init.png" alt=""></p>
</div>
<div class="col align-middle " style="text-align: center;"><p>The init system is the <em>first process</em> started by the <em>kernel</em>
<br>
(this is why it has <strong>PID=1</strong>)</p>
<h3 id="heading"></h3>
<h3 id="responsibilities">Responsibilities</h3>
<ul>
<li>
<p><em>Starting</em> all other <em>processes</em> (namely, the <strong>services</strong>):</p>
<ul>
<li>including the <em>display server</em> (e.g. X, Wayland)</li>
<li>including the <em>window manager</em> (e.g. Gnome, KDE)</li>
<li>including <em>daemons</em> and <em>services</em> (e.g. <code>sshd</code>, <code>httpd</code>)</li>
</ul>
</li>
<li>
<p><em>Mounting</em> the <strong>file systems</strong></p>
<ul>
<li>e.g. the <em>home</em> partition, the <em>swap</em> partition, etc.</li>
</ul>
</li>
<li>
<p><em>Setting up</em> the <strong>network</strong></p>
<ul>
<li>e.g. starting the <em>network manager</em>, hence connecting to the <em>default networks</em>, etc.</li>
</ul>
</li>
<li>
<p>Suspending/hibernating (and resuming), rebooting, and shutting down the system</p>
</li>
</ul>
</div>
</div>
</div>
</section><section>
<h2 id="what-happens-when-you-boot-a-linux-system-2">What happens when you boot a Linux system?</h2>
<h3 id="once-the-system-is-up-and-running">Once the system is up and running‚Ä¶</h3>

<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><p><img src="./boot-architecture.png" alt=""></p>
</div>
<div class="col align-middle " style="text-align: center; margin-top:30vh;"><p>The init system has:</p>
<ol>
<li>started all the system services</li>
<li>mounted all the file systems</li>
<li>set up the network</li>
<li>started the display server</li>
<li>started the window manager</li>
<li>started the user session</li>
</ol>
</div>
</div>
</div>
</section><section>
<h2 id="os-services-and-daemons">OS Services and Daemons</h2>
<p>In the context of <em>operative systems</em> (OS):</p>
<ul>
<li>
<p>a <strong>service</strong> is a <em>process</em> that runs <em>continuously</em> in the background</p>
<ul>
<li>it is <em>started</em> and <em>stopped</em> by the OS (actually, by the <em>init system</em>), often with <em>administrative privileges</em></li>
<li>it offers some <em>functionality</em> to the <em>user</em> or to other <em>services</em></li>
</ul>
</li>
<li>
<p>in the *nix world, <strong>‚Äúdaemon‚Äù</strong> is a <em>synonym</em> for ‚Äúservice‚Äù</p>
<ul>
<li>the term <a href="https://en.wikipedia.org/wiki/Daemon_(computing)">comes from Greek mythology</a>:
a <em>daimon</em> is a <em>spirit</em> that acts as an <em>intermediary</em> between <em>humans</em> and the <em>gods</em></li>
</ul>
</li>
</ul>


<span class="fragment ">
  <h3 id="examples-of-servicesdaemons-in-a-linux-system">Examples of services/daemons in a Linux system</h3>
<ul>
<li><code>sshd</code> (the <em>SSH daemon</em>) is a service that allows clients to <em>remotely connect</em> to the system, via the <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH protocol</a></li>
<li><code>ssh-agent</code> is a service that <em>manages</em> SSH keys for the user</li>
<li><code>httpd</code> (the <em>HTTP daemon</em>) is a service that <em>serves</em> web pages to clients, via the <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP protocol</a></li>
<li><code>cupsd</code> (the <em>CUPS daemon</em>) is a service that <em>manages</em> printers, via the <a href="https://en.wikipedia.org/wiki/CUPS">CUPS protocol</a></li>
<li><code>dockerd</code> (the <em>Docker daemon</em>) is a service that <em>manages</em> containers on a given host</li>
</ul>

</span>

</section><section>
<h2 id="init-systems">Init systems</h2>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Init">SysVinit</a> (1980s‚Äîearly 2000s) first family of init systems for Unix-like systems</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Upstart_(software)">Upstart</a> (2006‚Äî2014) developed by Canonical for Ubuntu</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Runit">runit</a> (2004‚Äîpresent) used by niche Linux distributions</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/OpenRC">OpenRC</a> (2007‚Äîpresent) used by Gentoo and Alpine Linux</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Launchd">launchd</a> (2005‚Äîpresent) used by macOS, developed by Apple</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Systemd">systemd</a> (2010‚Äîpresent) inspired by <code>launchd</code>, used by most Linux distributions nowadays</p>
</li>
<li>
<p>Comparison here: <a href="https://wiki.gentoo.org/wiki/Comparison_of_init_systems">https://wiki.gentoo.org/wiki/Comparison_of_init_systems</a></p>
</li>
</ul>
</section><section>
<h2 id="what-is-systemd-pt-2">What is systemd? (pt. 2)</h2>
<blockquote>
<p><strong>systemd</strong> is a <em>suite</em> of system management <strong>daemons</strong>, <strong>libraries</strong>, and <strong>utilities</strong> designed as a <em>central management and configuration platform</em> for the Linux OS</p>
</blockquote>





<img src="systemd-components.svg" alt="" style="width: 100%; max-width: 95vw; max-height: 70vh; object-fit: contain;">

</section><section>
<h2 id="systemds-utilities-suite">systemd‚Äôs utilities suite</h2>
<p>The systemd <strong>suite</strong> includes the following <em>command-line</em> utilities (corresponding to relevant <em>daemon</em> services):</p>
<ul>
<li>
<p><code>systemctl</code> controls the <code>systemd</code> daemon, from which system- and user-level <em>services</em> can be managed</p>
</li>
<li>
<p><code>journalctl</code> queries messages from the <code>journald</code> daemon, which collects and stores <em>log messages</em> from the kernel and services</p>
</li>
<li>
<p><code>hostnamectl</code> controls the <code>hostnamed</code> daemon, from which the <em>name of the host</em> on the network can be read/set</p>
</li>
<li>
<p><code>loginctl</code> controls the <code>logind</code> daemon, which manages <em>user sessions</em> and <em>seats</em></p>
</li>
<li>
<p><code>timedatectl</code> controls the <code>timedated</code> daemon, which manages the <em>system clock</em> and <em>time zone</em></p>
</li>
<li>
<p><code>localectl</code> controls the <code>localed</code> daemon, which manages the <em>system locale</em> and <em>keyboard layout</em></p>
</li>
<li>
<p><code>busctl</code> controls the <code>bus-proxyd</code> daemon, which provides a <em>D-Bus</em> interface to the system bus</p>
</li>
<li>
<p><code>networkctl</code> controls the <code>networkd</code> daemon, which manages <em>network configurations</em></p>
</li>
<li>
<p><code>resolvectl</code> controls the <code>resolved</code> daemon, which manages <em>DNS</em> configurations</p>
</li>
</ul>
</section><section>
<h2 id="remarks">Remarks</h2>
<blockquote>
<p>This lecture is about the usage of systemd as the <strong>service manager</strong> for Linux
<br>(i.e., put simply, how to use <code>systemctl</code> and <code>journalctl</code>)</p>
</blockquote>
<ul>
<li>
<p>‚Ä¶ but the systemd suite is much more than that!</p>
</li>
<li>
<p>Overall, systemd is a set of tool for <em>system administration</em></p>
<ul>
<li>you can control most aspects of a Linux system using systemd‚Äôs utilities</li>
</ul>
</li>
</ul>


<span class="fragment ">
  <h3 id="beware">Beware!</h3>
<ul>
<li>
<p>systemd is a <strong>controversial</strong> piece of software inside the <em>FOSS</em> community</p>
<ul>
<li>it has been criticized because it <a href="https://www.zdnet.com/article/linus-torvalds-and-others-on-linuxs-systemd/">arguably violates</a> the <a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix philosophy</a></li>
<li>it has been criticized as a <em>mission creep</em> (i.e., it does too much) and as a <em>feature creep</em> (i.e., it has too many features)</li>
<li>yet, it is the <em>de facto</em> standard for most (and most relevant) <a href="https://en.wikipedia.org/wiki/Systemd#Adoption">Linux distributions</a></li>
</ul>
</li>
<li>
<p>Yet, <strong>do not expect</strong> all distros to implement/support all the features of the systemd suite</p>
</li>
</ul>

</span>

</section><section>


<section data-shortcode-section="">
<h1 id="a-taste-of-the-systemd-suite">A taste of the systemd suite</h1>
<p>before delving into the details of <code>systemctl</code> and <code>journalctl</code></p>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-1">A taste of the systemd suite (pt. 1)</h2>
<h3 id="hostname-management">Hostname Management</h3>
<br>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><ol>
<li>Get an overview with <code>hostnamectl --help</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>hostnamectl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Query or change system hostname.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Commands:
</span></span><span style="display:flex;"><span>  status                 Show current hostname settings
</span></span><span style="display:flex;"><span>  hostname <span style="color:#ce5c00;font-weight:bold">[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span>        Get/set system hostname
</span></span><span style="display:flex;"><span>  icon-name <span style="color:#ce5c00;font-weight:bold">[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span>       Get/set icon name <span style="color:#204a87;font-weight:bold">for</span> host
</span></span><span style="display:flex;"><span>  chassis <span style="color:#ce5c00;font-weight:bold">[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span>         Get/set chassis <span style="color:#204a87">type</span> <span style="color:#204a87;font-weight:bold">for</span> host
</span></span><span style="display:flex;"><span>  deployment <span style="color:#ce5c00;font-weight:bold">[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span>      Get/set deployment environment <span style="color:#204a87;font-weight:bold">for</span> host
</span></span><span style="display:flex;"><span>  location <span style="color:#ce5c00;font-weight:bold">[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span>        Get/set location <span style="color:#204a87;font-weight:bold">for</span> host
</span></span></code></pre></div></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><ol start="2">
<li>See information about the <em>current hostname</em> with <code>hostnamectl status</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span> Static hostname: lubuntu2410-vm
</span></span><span style="display:flex;"><span>       Icon name: computer-vm
</span></span><span style="display:flex;"><span>         Chassis: vm üñ¥
</span></span><span style="display:flex;"><span>      Machine ID: 7fc69dab56a64d73b4f2ae5077df58a0
</span></span><span style="display:flex;"><span>         Boot ID: 7b52bffe735b47a18135db49790a4cc9
</span></span><span style="display:flex;"><span>  Virtualization: oracle
</span></span><span style="display:flex;"><span>Operating System: Ubuntu 24.10
</span></span><span style="display:flex;"><span>          Kernel: Linux 6.11.0-9-generic
</span></span><span style="display:flex;"><span>    Architecture: x86-64
</span></span><span style="display:flex;"><span> Hardware Vendor: innotek GmbH
</span></span><span style="display:flex;"><span>  Hardware Model: VirtualBox
</span></span><span style="display:flex;"><span>Firmware Version: VirtualBox
</span></span><span style="display:flex;"><span>   Firmware Date: Fri 2006-12-01
</span></span><span style="display:flex;"><span>    Firmware Age: 17y 11month 1w 4d
</span></span></code></pre></div></li>
</ol>
</div>
</div>
</div>
<ol start="3">
<li>Update the system <em>hostname</em> with <code>hostnamectl hostname my-new-hostname</code></li>
</ol>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-2">A taste of the systemd suite (pt. 2)</h2>
<h3 id="user-login-and-session-management">User Login and Session Management</h3>
<ol>
<li>Get an overview with <code>loginctl --help</code> (sub-commands are organized in <em>Session</em>, <em>User</em>, and <em>Seat</em> commands)
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>loginctl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Send control commands to or query the login manager.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Session Commands:
</span></span><span style="display:flex;"><span>list-sessions            List sessions
</span></span><span style="display:flex;"><span>session-status <span style="color:#ce5c00;font-weight:bold">[</span>ID...<span style="color:#ce5c00;font-weight:bold">]</span>   Show session status
</span></span><span style="display:flex;"><span>show-session <span style="color:#ce5c00;font-weight:bold">[</span>ID...<span style="color:#ce5c00;font-weight:bold">]</span>     Show properties of sessions or the manager
</span></span><span style="display:flex;"><span>activate <span style="color:#ce5c00;font-weight:bold">[</span>ID<span style="color:#ce5c00;font-weight:bold">]</span>            Activate a session
</span></span><span style="display:flex;"><span>lock-session <span style="color:#ce5c00;font-weight:bold">[</span>ID...<span style="color:#ce5c00;font-weight:bold">]</span>     Screen lock one or more sessions
</span></span><span style="display:flex;"><span>unlock-session <span style="color:#ce5c00;font-weight:bold">[</span>ID...<span style="color:#ce5c00;font-weight:bold">]</span>   Screen unlock one or more sessions
</span></span><span style="display:flex;"><span>lock-sessions            Screen lock all current sessions
</span></span><span style="display:flex;"><span>unlock-sessions          Screen unlock all current sessions
</span></span><span style="display:flex;"><span>terminate-session ID...  Terminate one or more sessions
</span></span><span style="display:flex;"><span>kill-session ID...       Send signal to processes of a session
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User Commands:
</span></span><span style="display:flex;"><span>list-users               List users
</span></span><span style="display:flex;"><span>user-status <span style="color:#ce5c00;font-weight:bold">[</span>USER...<span style="color:#ce5c00;font-weight:bold">]</span>    Show user status
</span></span><span style="display:flex;"><span>show-user <span style="color:#ce5c00;font-weight:bold">[</span>USER...<span style="color:#ce5c00;font-weight:bold">]</span>      Show properties of users or the manager
</span></span><span style="display:flex;"><span>enable-linger <span style="color:#ce5c00;font-weight:bold">[</span>USER...<span style="color:#ce5c00;font-weight:bold">]</span>  Enable linger state of one or more users
</span></span><span style="display:flex;"><span>disable-linger <span style="color:#ce5c00;font-weight:bold">[</span>USER...<span style="color:#ce5c00;font-weight:bold">]</span> Disable linger state of one or more users
</span></span><span style="display:flex;"><span>terminate-user USER...   Terminate all sessions of one or more users
</span></span><span style="display:flex;"><span>kill-user USER...        Send signal to processes of a user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Seat Commands:
</span></span><span style="display:flex;"><span>list-seats               List seats
</span></span><span style="display:flex;"><span>seat-status <span style="color:#ce5c00;font-weight:bold">[</span>NAME...<span style="color:#ce5c00;font-weight:bold">]</span>    Show seat status
</span></span><span style="display:flex;"><span>show-seat <span style="color:#ce5c00;font-weight:bold">[</span>NAME...<span style="color:#ce5c00;font-weight:bold">]</span>      Show properties of seats or the manager
</span></span><span style="display:flex;"><span>attach NAME DEVICE...    Attach one or more devices to a seat
</span></span><span style="display:flex;"><span>flush-devices            Flush all device associations
</span></span><span style="display:flex;"><span>terminate-seat NAME...   Terminate all sessions on one or more seats
</span></span></code></pre></div></li>
</ol>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-2-1">A taste of the systemd suite (pt. 2)</h2>
<h3 id="user-login-and-session-management-1">User Login and Session Management</h3>
<ol start="2">
<li>
<p>Get an overview of the current situation with <code>loginctl</code> (no args):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>SESSION  UID USER SEAT  LEADER CLASS   TTY   IDLE SINCE
</span></span><span style="display:flex;"><span>    <span style="color:#0000cf;font-weight:bold">527</span> <span style="color:#0000cf;font-weight:bold">1000</span> user -     <span style="color:#0000cf;font-weight:bold">16410</span>  manager -     no   -
</span></span><span style="display:flex;"><span>    <span style="color:#0000cf;font-weight:bold">529</span> <span style="color:#0000cf;font-weight:bold">1000</span> user seat0 <span style="color:#0000cf;font-weight:bold">16591</span>  user    tty2  no   -
</span></span><span style="display:flex;"><span>    <span style="color:#0000cf;font-weight:bold">531</span> <span style="color:#0000cf;font-weight:bold">1000</span> user -     <span style="color:#0000cf;font-weight:bold">17051</span>  user    pts/1 no   -
</span></span></code></pre></div></li>
<li>
<p>A bit of nomenclature:</p>
<ul>
<li><strong>Session</strong>: a <em>login session</em> (e.g., a <em>TTY</em> session, an <em>SSH</em> session)</li>
<li><strong>User</strong>: a <em>user account</em> (e.g., <code>root</code>, <code>user</code>)</li>
<li><strong>Seat</strong>: a <em>physical or virtual seat</em> (e.g., a <em>display</em>, a <em>keyboard</em>, a <em>mouse</em>)</li>
<li><strong>Leader</strong>: the <em>PID</em> of the <em>session leader</em> (i.e., the <em>process</em> that started the session)</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-3">A taste of the systemd suite (pt. 3)</h2>
<h3 id="time-and-date-management">Time and Date Management</h3>
<br>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><ol>
<li>Get an overview with <code>timedatectl --help</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>timedatectl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Query or change system <span style="color:#204a87">time</span> and date settings.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Commands:
</span></span><span style="display:flex;"><span>  status                 Show current <span style="color:#204a87">time</span> settings
</span></span><span style="display:flex;"><span>  set-time TIME          Set system <span style="color:#204a87">time</span>
</span></span><span style="display:flex;"><span>  set-timezone ZONE      Set system <span style="color:#204a87">time</span> zone
</span></span><span style="display:flex;"><span>  list-timezones         Show known <span style="color:#204a87">time</span> zones
</span></span><span style="display:flex;"><span>  set-local-rtc BOOL     Control whether RTC is in <span style="color:#204a87">local</span> <span style="color:#204a87">time</span>
</span></span><span style="display:flex;"><span>  set-ntp BOOL           Control whether NTP is enabled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  timesync-status       Show status of systemd-timesyncd
</span></span><span style="display:flex;"><span>  show-timesync         Show properties of systemd-timesyncd
</span></span><span style="display:flex;"><span>  ntp-servers INTERFACE SERVER‚Ä¶
</span></span><span style="display:flex;"><span>                        Set the interface specific NTP servers
</span></span><span style="display:flex;"><span>  revert INTERFACE      Revert the interface specific NTP servers
</span></span></code></pre></div></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><ol start="2">
<li>
<p>See information about the <em>current time (zone)</em> with <code>timedatectl status</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>               Local time: lun 2024-11-11 10:56:28 CET
</span></span><span style="display:flex;"><span>           Universal time: lun 2024-11-11 09:56:28 UTC
</span></span><span style="display:flex;"><span>                 RTC time: lun 2024-11-11 09:56:27
</span></span><span style="display:flex;"><span>                Time zone: Europe/Rome <span style="color:#ce5c00;font-weight:bold">(</span>CET, +0100<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>System clock synchronized: yes
</span></span><span style="display:flex;"><span>              NTP service: active
</span></span><span style="display:flex;"><span>          RTC in <span style="color:#204a87">local</span> TZ: no
</span></span></code></pre></div></li>
<li>
<p>Show time-sync status with <code>timedatectl timesync-status</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>       Server: 185.125.190.57 <span style="color:#ce5c00;font-weight:bold">(</span>ntp.ubuntu.com<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Poll interval: 34min 8s <span style="color:#ce5c00;font-weight:bold">(</span>min: 32s<span style="color:#000;font-weight:bold">;</span> max 34min 8s<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>         Leap: normal
</span></span><span style="display:flex;"><span>      Version: <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>      Stratum: <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span>    Reference: 11FD1CFB
</span></span><span style="display:flex;"><span>    Precision: 1us <span style="color:#ce5c00;font-weight:bold">(</span>-25<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Root distance: 846us <span style="color:#ce5c00;font-weight:bold">(</span>max: 5s<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>       Offset: +4.710ms
</span></span><span style="display:flex;"><span>        Delay: 36.168ms
</span></span><span style="display:flex;"><span>       Jitter: 1.689122s
</span></span><span style="display:flex;"><span> Packet count: <span style="color:#0000cf;font-weight:bold">130</span>
</span></span><span style="display:flex;"><span>    Frequency: -53,092ppm
</span></span></code></pre></div></li>
</ol>
</div>
</div>
</div>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-4">A taste of the systemd suite (pt. 4)</h2>
<h3 id="locale-management">Locale Management</h3>
<blockquote>
<p><strong>Locale</strong> $\approx$ a set of <em>cultural conventions</em> that determine how <em>dates</em>, <em>times</em>, <em>numbers</em>, and <em>currency</em> are <strong>formatted</strong>.
<em>Keyboard layouts</em> are locale-specific too.</p>
</blockquote>
<br>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><ol>
<li>Get an overview with <code>localectl --help</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>localectl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Query or change system locale and keyboard settings.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Commands:
</span></span><span style="display:flex;"><span>  status                   Show current locale settings
</span></span><span style="display:flex;"><span>  set-locale LOCALE...     Set system locale
</span></span><span style="display:flex;"><span>  list-locales             Show known locales
</span></span><span style="display:flex;"><span>  set-keymap MAP <span style="color:#ce5c00;font-weight:bold">[</span>MAP<span style="color:#ce5c00;font-weight:bold">]</span>     Set console and X11 keyboard mappings
</span></span><span style="display:flex;"><span>  list-keymaps             Show known virtual console keyboard mappings
</span></span><span style="display:flex;"><span>  set-x11-keymap LAYOUT <span style="color:#ce5c00;font-weight:bold">[</span>MODEL <span style="color:#ce5c00;font-weight:bold">[</span>VARIANT <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS<span style="color:#ce5c00;font-weight:bold">]]]</span>
</span></span><span style="display:flex;"><span>                           Set X11 and console keyboard mappings
</span></span><span style="display:flex;"><span>  list-x11-keymap-models   Show known X11 keyboard mapping models
</span></span><span style="display:flex;"><span>  list-x11-keymap-layouts  Show known X11 keyboard mapping layouts
</span></span><span style="display:flex;"><span>  list-x11-keymap-variants <span style="color:#ce5c00;font-weight:bold">[</span>LAYOUT<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                           Show known X11 keyboard mapping variants
</span></span><span style="display:flex;"><span>  list-x11-keymap-options  Show known X11 keyboard mapping options
</span></span></code></pre></div></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><ol start="2">
<li>See information about the <em>current locale</em> with <code>localectl status</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>System Locale: <span style="color:#000">LANG</span><span style="color:#ce5c00;font-weight:bold">=</span>it_IT.UTF-8
</span></span><span style="display:flex;"><span>    VC Keymap: <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">unset</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>   X11 Layout: it
</span></span><span style="display:flex;"><span>    X11 Model: pc105
</span></span></code></pre></div></li>
</ol>
</div>
</div>
</div>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-5">A taste of the systemd suite (pt. 5)</h2>
<h3 id="network-management">Network Management</h3>
<br>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><ol>
<li>Get an overview with <code>networkctl --help</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>networkctl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Query and control the networking subsystem.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Commands:
</span></span><span style="display:flex;"><span>  list <span style="color:#ce5c00;font-weight:bold">[</span>PATTERN...<span style="color:#ce5c00;font-weight:bold">]</span>      List links
</span></span><span style="display:flex;"><span>  status <span style="color:#ce5c00;font-weight:bold">[</span>PATTERN...<span style="color:#ce5c00;font-weight:bold">]</span>    Show link status
</span></span><span style="display:flex;"><span>  lldp <span style="color:#ce5c00;font-weight:bold">[</span>PATTERN...<span style="color:#ce5c00;font-weight:bold">]</span>      Show LLDP neighbors
</span></span><span style="display:flex;"><span>  label                  Show current address label entries in the kernel
</span></span><span style="display:flex;"><span>  delete DEVICES...      Delete virtual netdevs
</span></span><span style="display:flex;"><span>  up DEVICES...          Bring devices up
</span></span><span style="display:flex;"><span>  down DEVICES...        Bring devices down
</span></span><span style="display:flex;"><span>  renew DEVICES...       Renew dynamic configurations
</span></span><span style="display:flex;"><span>  forcerenew DEVICES...  Trigger DHCP reconfiguration of all connected clients
</span></span><span style="display:flex;"><span>  reconfigure DEVICES... Reconfigure interfaces
</span></span><span style="display:flex;"><span>  reload                 Reload .network and .netdev files
</span></span><span style="display:flex;"><span>  edit FILES<span style="color:#000;font-weight:bold">|</span>DEVICES...  Edit network configuration files
</span></span><span style="display:flex;"><span>  cat <span style="color:#ce5c00;font-weight:bold">[</span>FILES<span style="color:#000;font-weight:bold">|</span>DEVICES...<span style="color:#ce5c00;font-weight:bold">]</span> Show network configuration files
</span></span><span style="display:flex;"><span>  mask FILES...          Mask network configuration files
</span></span><span style="display:flex;"><span>  unmask FILES...        Unmask network configuration files
</span></span><span style="display:flex;"><span>  persistent-storage BOOL
</span></span><span style="display:flex;"><span>                         Notify systemd-networkd <span style="color:#204a87;font-weight:bold">if</span> persistent storage is ready
</span></span></code></pre></div></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><ol start="2">
<li>
<p>Get the available <em>connections</em> with <code>networkctl list</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>systemd-networkd is not running, output might be incomplete.
</span></span><span style="display:flex;"><span>IDX LINK   TYPE     OPERATIONAL SETUP
</span></span><span style="display:flex;"><span>  <span style="color:#0000cf;font-weight:bold">1</span> lo     loopback -           unmanaged
</span></span><span style="display:flex;"><span>  <span style="color:#0000cf;font-weight:bold">2</span> enp0s3 ether    -           unmanaged
</span></span></code></pre></div><ul>
<li><code>unmanaged</code> $\approx$ the network is not managed by <code>networkd</code></li>
<li>the warning means that the <code>networkd</code> is not running
<ul>
<li><em>Ubuntu-based systems use <code>NetworkManager</code> instead</em>
<ul>
<li>to be controlled via the <code>nmcli</code> command</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Get the <em>status</em> of a specific <em>connection</em> with <br> <code>networkctl status LINK</code></p>
</li>
<li>
<p>Use <code>networkctl up/down LINK</code> to affect the <em>connection</em></p>
<ul>
<li>which implies <em>connecting</em> (up) or <em>disconnecting</em> (down)</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</section><section>
<h2 id="a-taste-of-the-systemd-suite-pt-6">A taste of the systemd suite (pt. 6)</h2>
<h3 id="dns-management">DNS Management</h3>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><ol>
<li>Get an overview with <code>resolvectl --help</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>resolvectl <span style="color:#ce5c00;font-weight:bold">[</span>OPTIONS...<span style="color:#ce5c00;font-weight:bold">]</span> COMMAND ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Send control commands to the network name resolution manager, or
</span></span><span style="display:flex;"><span>resolve domain names, IPv4 and IPv6 addresses, DNS records, and services.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Commands:
</span></span><span style="display:flex;"><span>  query HOSTNAME<span style="color:#000;font-weight:bold">|</span>ADDRESS...    Resolve domain names, IPv4 and IPv6 addresses
</span></span><span style="display:flex;"><span>  service <span style="color:#ce5c00;font-weight:bold">[[</span>NAME<span style="color:#ce5c00;font-weight:bold">]</span> TYPE<span style="color:#ce5c00;font-weight:bold">]</span> DOMAIN Resolve service <span style="color:#ce5c00;font-weight:bold">(</span>SRV<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  openpgp EMAIL@DOMAIN...      Query OpenPGP public key
</span></span><span style="display:flex;"><span>  tlsa DOMAIN<span style="color:#ce5c00;font-weight:bold">[</span>:PORT<span style="color:#ce5c00;font-weight:bold">]</span>...        Query TLS public key
</span></span><span style="display:flex;"><span>  status <span style="color:#ce5c00;font-weight:bold">[</span>LINK...<span style="color:#ce5c00;font-weight:bold">]</span>             Show link and server status
</span></span><span style="display:flex;"><span>  statistics                   Show resolver statistics
</span></span><span style="display:flex;"><span>  reset-statistics             Reset resolver statistics
</span></span><span style="display:flex;"><span>  flush-caches                 Flush all <span style="color:#204a87">local</span> DNS caches
</span></span><span style="display:flex;"><span>  reset-server-features        Forget learnt DNS server feature levels
</span></span><span style="display:flex;"><span>  monitor                      Monitor DNS queries
</span></span><span style="display:flex;"><span>  show-cache                   Show cache contents
</span></span><span style="display:flex;"><span>  show-server-state            Show servers state
</span></span><span style="display:flex;"><span>  dns <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>SERVER...<span style="color:#ce5c00;font-weight:bold">]]</span>       Get/set per-interface DNS server address
</span></span><span style="display:flex;"><span>  domain <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>DOMAIN...<span style="color:#ce5c00;font-weight:bold">]]</span>    Get/set per-interface search domain
</span></span><span style="display:flex;"><span>  default-route <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>BOOL<span style="color:#ce5c00;font-weight:bold">]]</span>  Get/set per-interface default route flag
</span></span><span style="display:flex;"><span>  llmnr <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>MODE<span style="color:#ce5c00;font-weight:bold">]]</span>          Get/set per-interface LLMNR mode
</span></span><span style="display:flex;"><span>  mdns <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>MODE<span style="color:#ce5c00;font-weight:bold">]]</span>           Get/set per-interface MulticastDNS mode
</span></span><span style="display:flex;"><span>  dnsovertls <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>MODE<span style="color:#ce5c00;font-weight:bold">]]</span>     Get/set per-interface DNS-over-TLS mode
</span></span><span style="display:flex;"><span>  dnssec <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>MODE<span style="color:#ce5c00;font-weight:bold">]]</span>         Get/set per-interface DNSSEC mode
</span></span><span style="display:flex;"><span>  nta <span style="color:#ce5c00;font-weight:bold">[</span>LINK <span style="color:#ce5c00;font-weight:bold">[</span>DOMAIN...<span style="color:#ce5c00;font-weight:bold">]]</span>       Get/set per-interface DNSSEC NTA
</span></span><span style="display:flex;"><span>  revert LINK                  Revert per-interface configuration
</span></span><span style="display:flex;"><span>  log-level <span style="color:#ce5c00;font-weight:bold">[</span>LEVEL<span style="color:#ce5c00;font-weight:bold">]</span>            Get/set logging threshold <span style="color:#204a87;font-weight:bold">for</span> systemd-resolved
</span></span></code></pre></div></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><ol start="2">
<li>
<p>Get the IP corresponding to some <em>domain</em> with <br> <code>resolvectl query DOMAIN</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>$ resolvectl query www.google.it
</span></span><span style="display:flex;"><span>www.google.it: 142.251.209.35                  -- link: enp0s3
</span></span><span style="display:flex;"><span>               2a00:1450:4002:411::2003        -- link: enp0s3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Information acquired via protocol DNS in 74.5ms.
</span></span><span style="display:flex;"><span>-- Data is authenticated: no<span style="color:#000;font-weight:bold">;</span> Data was acquired via <span style="color:#204a87">local</span> or encrypted transport: no
</span></span><span style="display:flex;"><span>-- Data from: network
</span></span></code></pre></div></li>
<li>
<p>Get which protocols are being used with <code>resolvectl status</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>Global
</span></span><span style="display:flex;"><span>         Protocols: -LLMNR -mDNS -DNSOverTLS <span style="color:#000">DNSSEC</span><span style="color:#ce5c00;font-weight:bold">=</span>no/unsupported
</span></span><span style="display:flex;"><span>  resolv.conf mode: stub
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Link <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">(</span>enp0s3<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Current Scopes: DNS
</span></span><span style="display:flex;"><span>         Protocols: +DefaultRoute -LLMNR -mDNS -DNSOverTLS <span style="color:#000">DNSSEC</span><span style="color:#ce5c00;font-weight:bold">=</span>no/unsupported
</span></span><span style="display:flex;"><span>Current DNS Server: 10.0.2.3
</span></span><span style="display:flex;"><span>       DNS Servers: 10.0.2.3
</span></span></code></pre></div></li>
<li>
<p>Show DNS caches with <code>sudo resolvectl show-cache</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>Scope <span style="color:#000">protocol</span><span style="color:#ce5c00;font-weight:bold">=</span>dns <span style="color:#000">ifindex</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#000">ifname</span><span style="color:#ce5c00;font-weight:bold">=</span>enp0s3
</span></span><span style="display:flex;"><span>www.google.it IN A 142.251.209.35
</span></span><span style="display:flex;"><span>www.google.it IN AAAA 2a00:1450:4002:411::2003
</span></span></code></pre></div></li>
</ol>
</div>
</div>
</div>

</section>
</section><section>
<h1 id="systemd-for-service-management">systemd for service management</h1>
<p>How to use <code>systemctl</code> and <code>journalctl</code>?</p>
</section><section>
<h2 id="overall-functioning-of-systemd">Overall functioning of <code>systemd</code></h2>
<ol>
<li>
<p>The <code>systemd</code> daemon is started by the kernel as the first process</p>
</li>
<li>
<p>Upon startup, <code>systemd</code> reads the <em>unit files</em> from the <em>filesystem</em></p>
<ul>
<li><em>unit files</em> are <em>declaritive</em> text files that describe a <strong>unit</strong></li>
<li>a <strong>unit</strong> is a <em>resource</em> that <code>systemd</code> knows how to manage (e.g., a <em>service</em>, a <em>timer</em>, etc.)</li>
</ul>
</li>
<li>
<p><code>systemd</code> computes in which <em>order</em> the units should be <em>started</em></p>
<ul>
<li>this is done by <em>analyzing the dependencies</em> between the units
<ul>
<li>which are <em>declared</em> in the unit files</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>systemd</code> then <em>starts</em> the units in the <em>correct order</em></p>
<ul>
<li>and <em>monitors</em> them to ensure they <em>stay running</em></li>
</ul>
</li>
<li>
<p>Upon a user request to <em>shut down</em> / <em>suspend</em> / <em>hibernate</em> the system, <code>systemd</code> <strong>stops</strong> the units in the <em>correct order</em></p>
<ul>
<li>and <strong>restarts</strong> them upon <em>resuming</em> the system (if needed)</li>
</ul>
</li>
</ol>
</section><section>


<section data-shortcode-section="">
<h2 id="main-sorts-of-units-see-official-dochttpswwwfreedesktoporgsoftwaresystemdmanlatestsystemdunithtmldescription">Main sorts of units (see <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#Description">official doc</a>)</h2>
<blockquote>
<ul>
<li>Units are classified <em>by the <strong>suffix</strong></em> (a.k.a. <em>extension</em>) of their <em>unit file</em></li>
<li>You can <em>list</em> loaded units via <code>systemctl list-units [--type=TYPE]</code></li>
<li>You can <em>inspect</em> / <em>locate</em> some loaded <em>unit <strong>file</strong></em> via <code>systemctl cat NAME.TYPE</code>
<ul>
<li>use <code>systemctl show NAME.TYPE</code> to inspect <em>all</em> the properties of a <strong>unit</strong></li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#"><code>service</code> units</a>: a <em>process</em> that needs to be <em>started</em> and <em>managed</em> by <code>systemd</code></p>
<ul>
<li>e.g., <code>ssh.service</code>, <code>ufw.service</code>, <code>cups.service</code></li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.timer.html#"><code>timer</code> units</a>: a timer controlled and supervised by <code>systemd</code>, for <em>timer-based activation</em></p>
<ul>
<li>e.g., <code>apt-daily.timer</code>, <code>apt-daily-upgrade.timer</code></li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.target.html#"><code>target</code> units</a>: a <em>group</em> of units, to set <em>synchronization</em> points for ordering dependencies with other units</p>
<ul>
<li>e.g., <code>multi-user.target</code>, <code>graphical.target</code></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="other-sorts-of-units-see-official-dochttpswwwfreedesktoporgsoftwaresystemdmanlatestsystemdunithtmldescription">Other sorts of units (see <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#Description">official doc</a>)</h2>
<ul>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.socket.html#"><code>socket</code> units</a>: an <em>IPC</em> or network socket or a file system FIFO controlled and supervised by <code>systemd</code>, for <em>socket-based activation</em></p>
<ul>
<li>e.g., <code>ssh.socket</code>, <code>httpd.socket</code></li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.mount.html#"><code>mount</code> units</a>: a file system mount point controlled and supervised by <code>systemd</code></p>
<ul>
<li>e.g., <code>home.mount</code>, <code>var.mount</code> (system partitions are usually mounted by <code>systemd</code>)</li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.path.html#"><code>path</code> units</a>: a path monitored by <code>systemd</code>, for <em>path-based activation</em></p>
<ul>
<li>e.g., <code>cups.path</code></li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.slice.html#"><code>slice</code> units</a>: a <em>group</em> of related processes, for which <em>common resource limitations</em> can apply</p>
<ul>
<li>e.g., <code>user-1000.slice</code> (i.e. the <em>slice</em> for the user with UID=1000), <code>-.slice</code> (i.e. the <em>root slice</em>)</li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.device.html#"><code>device</code> units</a>: a unit describing the configuration of a <em>device</em> in <code>/dev</code></p>
<ul>
<li>e.g., <code>dev-ttyS0.device</code> corresponds to the <em>serial port</em> <code>/dev/ttyS0</code></li>
</ul>
</li>
<li>
<p><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.swap.html#"><code>swap</code> units</a>: a <em>swap partition</em> controlled and supervised by <code>systemd</code></p>
<ul>
<li>e.g., <code>swapfile.swap</code></li>
</ul>
</li>
</ul>

</section>
</section><section>
<h2 id="about-targets">About Targets</h2>
<blockquote>
<p><strong>Targets</strong> $\approx$ checkpoints in the <em>boot process</em> where units have been <em>started</em> and are <em>running</em></p>
</blockquote>

<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><h3 id="boot-logs">Boot logs</h3>
<img src="./logs.svg" alt="" style="width: 100%; max-width: 95vw; max-height: 60vh; object-fit: contain;">
</div>
<div class="col align-middle " style="text-align: center;"><h3 id="target-dependencies">Target dependencies</h3>
<p><img src="./targets.png" alt=""></p>
</div>
<div class="col align-middle " style="text-align: center;"><h3 id="startup-time">Startup time</h3>
<p>(<code>systemd-analyze plot &gt; plot.svg</code>)</p>
<img src="./time-plot.svg" alt="" style="width: 100%; max-width: 95vw; max-height: 50vh; object-fit: contain;">
</div>
</div>
</div>
</section><section>
<h2 id="unit-files-pt-1">Unit files (pt. 1)</h2>
<h3 id="example-the-_ssh-daemon_-unit-file">Example: the <em>SSH daemon</em> unit file</h3>
<p>(Use <code>systemctl cat ssh.service</code> to inspect your <em>SSH daemon</em>‚Äôs unit file)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># /usr/lib/systemd/system/ssh.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">OpenBSD Secure Shell server</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Documentation</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">man:sshd(8) man:sshd_config(5)</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">After</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">network.target nss-user-lookup.target auditd.service</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ConditionPathExists</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">!/etc/ssh/sshd_not_to_be_run</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">EnvironmentFile</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">-/etc/default/ssh           # cat /etc/default/ssh</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ExecStartPre</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">/usr/sbin/sshd -t              # man sshd | grep -e '-t'</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">/usr/sbin/sshd -D $SSHD_OPTS      # man sshd | grep -e '-D'</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ExecReload</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">/usr/sbin/sshd -t</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ExecReload</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">/bin/kill -HUP $MAINPID          # sends a HUP ("Hang UP") signal to the main process</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">KillMode</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">process</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">on-failure</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">RestartPreventExitStatus</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">255</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">notify</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">RuntimeDirectory</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">sshd</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">RuntimeDirectoryMode</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">0755</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">multi-user.target</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Alias</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">sshd.service</span>
</span></span></code></pre></div></section><section>


<section data-shortcode-section="">
<h2 id="unit-files-pt-2">Unit files (pt. 2)</h2>
<h3 id="location-of-unit-files">Location of unit files</h3>
<ol>
<li>
<p><strong>System unit files</strong> for <em>the distribution</em> are usually stored in <code>/lib/systemd/system/</code></p>
<ul>
<li>on most distributions, <code>/lib</code> is a <em>sym-link</em> to <code>/usr/lib</code>, so the actual path is <code>/usr/lib/systemd/system/</code></li>
<li>try <code>tree -C /lib/systemd/system/ | less</code> to see the <em>system unit files</em></li>
</ul>
</li>
<li>
<p>Administrators can <em>override</em> these system unit files by placing <strong>custom unit files</strong> in <code>/etc/systemd/system/</code></p>
<ul>
<li><em>custom</em> unit files take <strong>precedence</strong> over <em>system</em> unit files</li>
<li>try <code>tree -C /etc/systemd/system/ | less</code> to see the <em>custom unit files</em></li>
</ul>
</li>
<li>
<p><em>User unit files</em> are stored in <code>~/.config/systemd/user/</code></p>
<ul>
<li>try <code>tree -C ~/.config/systemd/user/ | less</code> to see the <em>user unit files</em></li>
</ul>
</li>
</ol>
</section><section>
<h2 id="unit-files-pt-2-1">Unit files (pt. 2)</h2>
<h3 id="full-look-up-locations-priority-list-according-to-the-official-dochttpswwwfreedesktoporgsoftwaresystemdmanlatestsystemdunithtml">Full look-up locations priority list (according to the <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html">official doc</a>)</h3>
<p>(descending order of precedence)</p>
<div class="div w-100">
    <div class="row "><div class="col align-middle " style="text-align: center;"><h4 id="system-unit-search-path">System Unit Search Path</h4>
<ol>
<li><code>/etc/systemd/system.control/*</code></li>
<li><code>/run/systemd/system.control/*</code></li>
<li><code>/run/systemd/transient/*</code></li>
<li><code>/run/systemd/generator.early/*</code></li>
<li><code>/etc/systemd/system/*</code></li>
<li><code>/etc/systemd/system.attached/*</code></li>
<li><code>/run/systemd/system/*</code></li>
<li><code>/run/systemd/system.attached/*</code></li>
<li><code>/run/systemd/generator/*</code></li>
<li><code>/usr/local/lib/systemd/system/*</code></li>
<li><code>/usr/lib/systemd/system/*</code></li>
<li><code>/run/systemd/generator.late/*</code></li>
</ol>
</div>
<div class="col align-middle " style="text-align: center;"><h4 id="user-unit-search-path">User Unit Search Path</h4>
<ol>
<li><code>~/.config/systemd/user.control/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/user.control/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/transient/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/generator.early/*</code></li>
<li><code>~/.config/systemd/user/*</code></li>
<li><code>$XDG_CONFIG_DIRS/systemd/user/*</code></li>
<li><code>/etc/systemd/user/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/user/*</code></li>
<li><code>/run/systemd/user/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/generator/*</code></li>
<li><code>$XDG_DATA_HOME/systemd/user/*</code></li>
<li><code>$XDG_DATA_DIRS/systemd/user/*</code></li>
<li><code>/usr/local/lib/systemd/user/*</code></li>
<li><code>/usr/lib/systemd/user/*</code></li>
<li><code>$XDG_RUNTIME_DIR/systemd/generator.late/*</code></li>
</ol>
</div>
</div>
</div>

</section>
</section><section>


<section data-shortcode-section="">
<h2 id="unit-files-pt-3">Unit files (pt. 3)</h2>
<h3 id="syntax-of-unit-files">Syntax of unit files</h3>
<p>Syntax is inspired to <a href="https://en.wikipedia.org/wiki/INI_file">Window‚Äôs <code>.ini</code> files</a>:</p>
<blockquote>
<p>a bunch of <code>[Sections]</code> with <code>Key=Value</code> pairs, one per line, using <code>#</code> for comments</p>
</blockquote>
<h3 id="example">Example</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Section]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Key1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Value1</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Key2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Value2</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># this is a comment</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[AnotherSection]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># this is another comment</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Key3</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Value3</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Key3</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Some keys can be repeated</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Key4</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Value4</span>
</span></span></code></pre></div></section><section>
<h2 id="unit-files-pt-3-1">Unit files (pt. 3)</h2>
<h3 id="syntax-of-unit-files-1">Syntax of unit files</h3>
<ul>
<li>
<p>In <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#%5BUnit%5D%20Section%20Options">section <code>[Unit]</code></a>
one should write <em>generic information</em> about the <strong>unit</strong> that is NOT dependent on the type of unit:</p>
<ul>
<li><code>Description=</code> a short <em>human-readable</em> <strong>title</strong> of the unit, to be shown in the logs</li>
<li><code>Documentation=</code> a space-separated list of <em>URLs</em> to the <strong>documentation</strong> of the unit</li>
<li><code>Before=</code>, <code>After=</code> a space-separated list of <em>unit</em> that <strong>must be started</strong> <em>after/before</em> this unit</li>
<li><code>ConditionPathExists=</code> a <em>path</em> that must (NOT, if prefixed by <code>!</code>) <strong>exist</strong> for the unit to be started</li>
</ul>
</li>
<li>
<p>In <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html#%5BInstall%5D%20Section%20Options">section <code>[Install]</code></a>
one should write <em>information</em> about how the unit is <strong>installed</strong>:</p>
<ul>
<li><em>installation</em> of a unit (a.k.a. <strong>enabling</strong> it) $\approx$ <em>manually</em> configuring the unit for <em>automatic</em> start-up
<ul>
<li><em><strong>de</strong>installation</em> of a unit (a.k.a. <strong>disabling</strong> it) $\approx$ <em>manually</em> configuring the unit for <em>manual</em> start-up</li>
</ul>
</li>
<li><code>Alias=</code> a space-separated list of <em>alternative names</em> for the unit</li>
<li><code>Also=</code> additional units to install/deinstall when this unit is installed/deinstalled</li>
<li><code>WantedBy=, RequiredBy=, UpheldBy=</code> these properties are related to <em>dependency management</em>, explained later</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="unit-files-pt-3-2">Unit files (pt. 3)</h2>
<h3 id="syntax-of-service-unit-files-12">Syntax of <code>.service</code> unit files (1/2)</h3>
<ul>
<li>In <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Options">section <code>[Service]</code></a>
one should write information about the <strong>service</strong> and the process it supervises
<ul>
<li><code>ExecStartPre=</code>, <code>ExecStartPost=</code> command to be <strong>executed</strong> <em>before/after</em> the <em>main command</em> (for testing purposes)</li>
<li><code>ExecStart=</code> the <em>main command</em> to be executed to <strong>start</strong> the service
<ul>
<li>the <strong>PID</strong> of the service‚Äôs process is stored in <code>$MAINPID</code></li>
</ul>
</li>
<li><code>ExecReload=</code> command(s) to be executed upon <strong>reloading</strong> of the service, before re-executing the <em>main command</em></li>
<li><code>Restart=</code> configures whether the service shall be <strong>restarted</strong> when the service process <em>exits</em>, is <em>killed</em>, or a <em>timeout</em> is reached
<ul>
<li>one of <code>no</code> (default), <code>on-success</code>, <code>on-failure</code>, <code>on-abnormal</code>, <code>on-watchdog</code>, <code>on-abort</code>, or <code>always</code> (cf. <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Restart=">official doc</a>)</li>
</ul>
</li>
<li><code>RestartPreventExitStatus=</code> a space-separated list of <em>exit status codes</em> that will <em>not</em> trigger a restart</li>
<li><code>Type=</code> configures the mechanism via which the service is considered <strong>activated</strong> ($\approx$ <em>started</em> and <em>ready</em> to be used)
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Type=">many options available</a>, e.g.:
<ul>
<li><code>exec</code> (after main process is <em>started</em>)</li>
<li><code>notify</code> (after it sends a <em>notification</em> via <code>sd_notify()</code>)</li>
<li><code>oneshot</code> (after the main process <em>exits</em>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="unit-files-pt-3-3">Unit files (pt. 3)</h2>
<h3 id="syntax-of-service-unit-files-22">Syntax of <code>.service</code> unit files (2/2)</h3>
<ul>
<li>
<p>Many options related to <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html">process execution</a> or <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.kill.html#">process killing apply</a> here</p>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html#EnvironmentFile="><code>EnvironmentFile=</code></a> the <strong>path</strong> to <em>file</em> that contains <em>environment variables</em> for the service</li>
<li><code>KillMode=</code> specifies how processes of this unit shall be <strong>killed</strong>:
<ul>
<li><code>process</code> $\rightarrow$ only the service process is killed</li>
<li><code>mixed</code> $\rightarrow$ signal <code>SIGKILL</code> is sent to <em>all processes</em> in the control group of this unit, <em>including the main one</em></li>
<li><code>control-group</code> $\rightarrow$ like <code>mixed</code>, <em>except the main one</em>, requires setting <code>ExecStop</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Beware of <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html#Command%20lines">special executable prefixes</a>: such as <code>-</code> (ignore errors), <code>+</code> (run in full privilege), <code>:</code> (do not expand variables), etc.</p>
</li>
</ul>

</section>
</section><section>
<h2 id="operating-with-units-pt-1">Operating with units (pt. 1)</h2>
<ul>
<li>Getting the <strong>runtime status</strong> of a unit: <code>systemctl status NAME.TYPE</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>$ systemctl status ssh
</span></span><span style="display:flex;"><span>‚óè ssh.service - OpenBSD Secure Shell server
</span></span><span style="display:flex;"><span>    Loaded: loaded <span style="color:#ce5c00;font-weight:bold">(</span>/usr/lib/systemd/system/ssh.service<span style="color:#000;font-weight:bold">;</span> disabled<span style="color:#000;font-weight:bold">;</span> preset: enabled<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Active: active <span style="color:#ce5c00;font-weight:bold">(</span>running<span style="color:#ce5c00;font-weight:bold">)</span> since Mon 2024-11-11 11:09:51 CET<span style="color:#000;font-weight:bold">;</span> <span style="color:#0000cf;font-weight:bold">1</span> day 1h ago
</span></span><span style="display:flex;"><span>Invocation: 95b989f6f1a94ccabefa0e9925ea4ede
</span></span><span style="display:flex;"><span>TriggeredBy: ‚óè ssh.socket
</span></span><span style="display:flex;"><span>    Docs: man:sshd<span style="color:#ce5c00;font-weight:bold">(</span>8<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            man:sshd_config<span style="color:#ce5c00;font-weight:bold">(</span>5<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>Main PID: <span style="color:#0000cf;font-weight:bold">1861</span> <span style="color:#ce5c00;font-weight:bold">(</span>sshd<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Tasks: <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">(</span>limit: 4598<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Memory: 6.2M <span style="color:#ce5c00;font-weight:bold">(</span>peak: 22.9M<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        CPU: 908ms
</span></span><span style="display:flex;"><span>    CGroup: /system.slice/ssh.service
</span></span><span style="display:flex;"><span>            ‚îî‚îÄ1861 <span style="color:#4e9a06">"sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nov <span style="color:#0000cf;font-weight:bold">12</span> 09:39:50 lubuntu2410-vm sshd<span style="color:#ce5c00;font-weight:bold">[</span>6813<span style="color:#ce5c00;font-weight:bold">]</span>: pam_systemd<span style="color:#ce5c00;font-weight:bold">(</span>sshd:session<span style="color:#ce5c00;font-weight:bold">)</span>: New sd-bus connection <span style="color:#ce5c00;font-weight:bold">(</span>system-bus-pam-systemd-6813<span style="color:#ce5c00;font-weight:bold">)</span> opened.
</span></span><span style="display:flex;"><span>nov <span style="color:#0000cf;font-weight:bold">12</span> 11:07:07 lubuntu2410-vm sshd<span style="color:#ce5c00;font-weight:bold">[</span>7083<span style="color:#ce5c00;font-weight:bold">]</span>: Accepted password <span style="color:#204a87;font-weight:bold">for</span> user from 10.0.2.2 port <span style="color:#0000cf;font-weight:bold">47930</span> ssh2
</span></span><span style="display:flex;"><span>nov <span style="color:#0000cf;font-weight:bold">12</span> 11:07:07 lubuntu2410-vm sshd<span style="color:#ce5c00;font-weight:bold">[</span>7083<span style="color:#ce5c00;font-weight:bold">]</span>: pam_unix<span style="color:#ce5c00;font-weight:bold">(</span>sshd:session<span style="color:#ce5c00;font-weight:bold">)</span>: session opened <span style="color:#204a87;font-weight:bold">for</span> user user<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">uid</span><span style="color:#ce5c00;font-weight:bold">=</span>1000<span style="color:#ce5c00;font-weight:bold">)</span> by user<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">uid</span><span style="color:#ce5c00;font-weight:bold">=</span>0<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>nov <span style="color:#0000cf;font-weight:bold">12</span> 11:07:07 lubuntu2410-vm sshd<span style="color:#ce5c00;font-weight:bold">[</span>7083<span style="color:#ce5c00;font-weight:bold">]</span>: pam_systemd<span style="color:#ce5c00;font-weight:bold">(</span>sshd:session<span style="color:#ce5c00;font-weight:bold">)</span>: New sd-bus connection <span style="color:#ce5c00;font-weight:bold">(</span>system-bus-pam-systemd-7083<span style="color:#ce5c00;font-weight:bold">)</span> opened.
</span></span></code></pre></div></li>
</ul>
</section><section>
<h2 id="operating-with-units-pt-2">Operating with units (pt. 2)</h2>
<ul>
<li>
<p><strong>Starting</strong> / <strong>stopping</strong> / <strong>restarting</strong> a unit: <code>sudo systemctl start|stop|restart NAME.TYPE</code></p>
<ul>
<li>use <code>systemctl --user start|stop|restart NAME.TYPE</code> for <em>user units</em> (no need for <code>sudo</code>)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>$ sudo systemctl stop ssh.service
</span></span><span style="display:flex;"><span>Stopping <span style="color:#4e9a06">'ssh.service'</span>, but its triggering units are still active:
</span></span><span style="display:flex;"><span>ssh.socket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo systemctl start ssh.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo systemctl restart ssh.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Attempts to do admin operations without sudo, will prompt for password:</span>
</span></span><span style="display:flex;"><span>$ systemctl stop ssh.service
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">====</span> AUTHENTICATING FOR org.freedesktop.systemd1.manage-units <span style="color:#ce5c00;font-weight:bold">====</span>
</span></span><span style="display:flex;"><span>Autenticazione richiesta per fermare <span style="color:#4e9a06">'ssh.service'</span>.
</span></span><span style="display:flex;"><span>Authenticating as: user
</span></span><span style="display:flex;"><span>Password:
</span></span></code></pre></div></li>
</ul>


<span class="fragment ">
  <blockquote>
<p><strong>Note</strong>: try stopping the <code>ssh.service</code> and see if you can <em>still connect</em> to the machine via SSH. <em>Why?</em></p>
</blockquote>

</span>

</section><section>
<h2 id="operating-with-units-pt-3">Operating with units (pt. 3)</h2>
<ul>
<li>Inspecting the <strong>dependencies</strong> of a unit: <code>systemctl list-dependencies NAME.TYPE</code>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>$ systemctl list-dependencies ssh.service
</span></span><span style="display:flex;"><span>ssh.service
</span></span><span style="display:flex;"><span>‚óè ‚îú‚îÄ-.mount
</span></span><span style="display:flex;"><span>‚óè ‚îú‚îÄssh.socket <span style="color:#8f5902;font-style:italic">############ &lt;--- notice this _socket unit_</span>
</span></span><span style="display:flex;"><span>‚óè ‚îú‚îÄsystem.slice
</span></span><span style="display:flex;"><span>‚óè ‚îî‚îÄsysinit.target
</span></span><span style="display:flex;"><span>‚óè   ‚îú‚îÄapparmor.service
</span></span><span style="display:flex;"><span>‚óã   ‚îú‚îÄ...
</span></span><span style="display:flex;"><span>‚óè   ‚îú‚îÄsystemd-update-utmp.service
</span></span><span style="display:flex;"><span>‚óè   ‚îú‚îÄlocal-fs.target
</span></span><span style="display:flex;"><span>‚óè   ‚îÇ ‚îú‚îÄ-.mount
</span></span><span style="display:flex;"><span>‚óè   ‚îÇ ‚îú‚îÄrun-lock.mount
</span></span><span style="display:flex;"><span>‚óã   ‚îÇ ‚îú‚îÄsystemd-fsck-root.service
</span></span><span style="display:flex;"><span>‚óè   ‚îÇ ‚îú‚îÄsystemd-remount-fs.service
</span></span><span style="display:flex;"><span>‚óè   ‚îÇ ‚îî‚îÄtmp.mount
</span></span><span style="display:flex;"><span>‚óè   ‚îî‚îÄswap.target
</span></span><span style="display:flex;"><span>‚óè     ‚îî‚îÄswapfile.swap
</span></span></code></pre></div></li>
</ul>
</section><section>
<h2 id="socket-activation">Socket activation</h2>
<ul>
<li>
<p>Some daemons work by <strong>listening</strong> for <em>incoming connections</em></p>
<ul>
<li>e.g., <code>sshd</code> listens on <em>TCP port</em> <code>22</code> for incoming <em>SSH</em> connections</li>
<li>e.g., <code>httpd</code> listens on <em>TCP port</em> <code>80</code> for incoming <em>HTTP</em> connections</li>
<li>e.g. <code>dockerd</code> listens on <em>Unix socket</em> <code>/var/run/docker.sock</code> for incoming <em>Docker</em> commands</li>
</ul>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Network_socket">‚ÄúSocket‚Äù</a> is a <em>software endpoint</em> of a process willing to communicate <em>over the network</em> (or locally)</p>
<ul>
<li>e.g. <code>INET</code> sockets (e.g., <code>TCP</code>, <code>UDP</code>) for <em>network</em> communication, <code>UNIX</code> sockets for <em>local</em> IPC</li>
</ul>
</li>
<li>
<p>Most commonly, the process willing to <strong>listen</strong> on a <em>socket</em>, would create the socket <em>upon startup</em>‚Ä¶</p>
<ul>
<li>here, time/computation is <em>wasted</em> to start up a process that may <em>just listen</em> for a while</li>
</ul>
</li>
<li>
<p>‚Ä¶ but <code>systemd</code> can <strong>listen</strong> on the <em>socket</em> <strong>instead of</strong> the <em>process</em>, and <strong>trigger</strong> the <em>process</em> upon <em>incoming connections</em></p>
<ul>
<li>this is called <strong>socket activation</strong></li>
</ul>
</li>
<li>
<p>To support <em>socket activation</em>, the <code>.service</code> unit file should have a <strong>corresponding</strong> <code>.socket</code> unit file</p>
</li>
</ul>
</section><section>
<h2 id="unit-files-pt-4">Unit files (pt. 4)</h2>
<h3 id="example-the-ssh-daemon-_socket_-unit-file">Example: the SSH daemon <em>socket</em> unit file</h3>
<p>(Use <code>systemctl cat ssh.socket</code> to inspect your SSH daemon‚Äôs <em>socket</em> unit file)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># /usr/lib/systemd/system/ssh.socket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">OpenBSD Secure Shell server socket</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Before</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">sockets.target ssh.service                   # notice the dependency on the ssh.service</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ConditionPathExists</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">!/etc/ssh/sshd_not_to_be_run</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Socket]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ListenStream</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">0.0.0.0:22                             # listen on all IPv4 interfaces on port 22</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ListenStream</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">[::]:22                                # listen on all IPv6 interfaces on port 22</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Accept</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">no</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">FreeBind</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">sockets.target</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">RequiredBy</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">ssh.service</span>
</span></span></code></pre></div></section><section>
<h2 id="unit-files-pt-4-1">Unit files (pt. 4)</h2>
<h3 id="syntax-of-socket-unit-files">Syntax of <code>.socket</code> unit files</h3>
<ul>
<li>In <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.socket.html#Options">section <code>[Socket]</code></a>
one should write information about the <strong>socket</strong> or FIFO the unit supervises
<ul>
<li><code>ListenStream=, ListenDatagram=, ListenSequentialPacket=</code> <strong>address</strong> to listen on for a <em>stream</em>, <em>datagram</em>, or <em>sequential packet</em> socket, respectively</li>
<li><code>Accept=</code> takes a <em>boolean</em> argument:
<ul>
<li><code>yes</code>: a service instance is spawned <em>for each</em> incoming connection and <em>only</em> the connection socket is passed to it</li>
<li><code>no</code>: <em>all</em> listening sockets themselves are passed to the started service unit, and <em>only one service</em> is spawned for all connections</li>
</ul>
</li>
<li><code>FreeBind=</code> controls whether the socket can be bound to <em>non-local IP</em> addresses</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="running-exercise-ssh-daemon-pt-1">Running Exercise: SSH daemon (pt. 1)</h2>
<ol>
<li>
<p>Try to <code>stop</code> the <code>ssh.service</code> and to <em>connect</em> to the machine via SSH</p>
<ul>
<li>you can <em>still connect</em> to the machine via SSH, because <code>ssh.socket</code> is <em>still active</em>
<ul>
<li>it will <em>start</em> the <code>ssh.service</code> <em>upon</em> an <em>incoming connection</em></li>
</ul>
</li>
<li>notice that the <code>ssh.service</code> is <em>active</em>, <strong>after</strong> the SSH connection is established</li>
</ul>
</li>
<li>
<p>Try to <code>stop</code> the <code>ssh.service</code> AND <code>ssh.socket</code>, then try to <em>connect</em> to the machine via SSH</p>
<ul>
<li>now you should be <em>unable</em> to connect to the machine via SSH
<ul>
<li>because the <code>ssh.socket</code> is <em>not active</em> to <em>start</em> the <code>ssh.service</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Try to <strong>reboot</strong> the system. Upon <em>startup</em>, are the <code>ssh.service</code> and <code>ssh.socket</code> units <em>active</em>?</p>
<ul>
<li>they should, because the units are <em>enabled</em> (i.e., they are <em>configured</em> for <em>automatic</em> start-up)</li>
<li>you should now be <em>able</em> to connect to the machine via SSH</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="operating-with-units-pt-4">Operating with units (pt. 4)</h2>
<ul>
<li>
<p><strong>Enabling</strong> / <strong>disabling</strong> a unit: <code>sudo systemctl enable|disable NAME.TYPE</code></p>
<ul>
<li>use <code>systemctl --user enable|disable NAME.TYPE</code> for <em>user units</em> (no need for <code>sudo</code>)</li>
</ul>
</li>
<li>
<p>The <em>effect</em> is that the <code>[Install]</code> section of the unit file is <em>interpreted</em></p>
<ul>
<li>‚Ä¶ and the <strong>dependencies</strong> therein specified are <em>installed</em> / <em>uninstalled</em> accordingly</li>
</ul>
</li>
<li>
<p>The <code>[Install]</code> section of a unit <em>$A$</em> would most commonly specify:</p>
<ul>
<li>some <code>WantedBy</code> dependency w.r.t. some <strong>target</strong> unit <em>$T$</em> $\implies$ <em>$A$</em> is <strong>started</strong> automatically when <em>$T$</em> is <strong>started</strong></li>
<li>some <code>RequiredBy</code> dependency w.r.t. some other unit <em>$B$</em> $\implies$ <em>$B$</em> <strong>requires</strong> <em>$A$</em> to be able to <strong>start</strong>
<ul>
<li>this is commonly the case for <em>socket</em> units, which are <em>required</em> by the <em>service</em> units they trigger</li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="running-exercise-ssh-daemon-pt-2">Running Exercise: SSH daemon (pt. 2)</h2>
<ol start="4">
<li>
<p>Try now to <code>disable</code> the <code>ssh.service</code> and <code>ssh.socket</code>, then try to <em>connect</em> to the machine via SSH</p>
<ul>
<li>you should <em>still</em> be <em>able</em> to connect to the machine via SSH
<ul>
<li>because the units are <em>not enabled</em>, but they are <em>still active</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Try to reboot the system. Upon <em>startup</em>, are the <code>ssh.service</code> and <code>ssh.socket</code> units <em>active</em>?</p>
<ul>
<li>they should <em>not</em>, because the units are <em>not enabled</em></li>
<li>you should now be <em>unable</em> to connect to the machine via SSH</li>
</ul>
</li>
<li>
<p>Try to <code>enable</code> the <code>ssh.service</code> and <code>ssh.socket</code>, then try to <em>connect</em> to the machine via SSH</p>
<ul>
<li>you should still be <em>unable</em> to connect to the machine via SSH
<ul>
<li>because the units are <em>enabled</em> but not <em>active</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Try to <code>start</code> the <code>ssh.service</code> and <code>ssh.socket</code>, then try to <em>connect</em> to the machine via SSH</p>
<ul>
<li>you should now be <em>able</em> to connect to the machine via SSH</li>
<li>the same is true after a <em>reboot</em></li>
</ul>
</li>
</ol>
</section><section>
<h2 id="about-dependencies-pt-1">About dependencies (pt. 1)</h2>
<p>Units may define <em>dependencies</em> on other units, which impact the <em>order</em> in which they are <em>started</em> and <em>stopped</em>:</p>
<ol>
<li>
<p><strong>Wanting</strong>: $A$ <code>Wants</code> $B$ (or $B$ <code>WantedBy</code> $A$) indicates a <em>weak</em> dependency</p>
<ul>
<li>if service $A$ <em>wants</em> service $B$, <code>systemd</code> will <em>attempt</em> to start $B$ when starting $A$</li>
<li>if $B$ fails or isn‚Äôt available, $A$ will still start</li>
<li>used when a unit <em>can benefit</em> from another service but doesn‚Äôt strictly require it
<ul>
<li>e.g., <strong>targets</strong> <em>want</em> services to be started, but don‚Äôt <em>require</em> them</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Requiring</strong>: $A$ <code>Requires</code> $B$ (or $B$ <code>RequiredBy</code> $A$) indicates a <em>strong</em> dependency</p>
<ul>
<li>if service $A$ <em>requires</em> service $B$, $A$ will <em>not</em> start unless $B$ starts successfully</li>
<li>if $B$ fails to start, <code>systemd</code> will stop $A$ as well</li>
<li>used when a unit is <em>essential</em> for another to function
<ul>
<li>e.g., <strong>services</strong> <em>require</em> <strong>sockets</strong> to be started before they can start</li>
</ul>
</li>
<li>yet, $A$ <code>Requires</code> $B$ does <strong>not</strong> imply $B$ <code>Before</code> $A$</li>
</ul>
</li>
<li>
<p><strong>Before</strong>/<strong>After</strong>: $A$ <code>Before</code> $B$ (or $B$ <code>After</code> $A$) indicates an <em>ordering</em> dependency</p>
<ul>
<li>if service $A$ <em>starts before</em> service $B$, <code>systemd</code> will <em>start</em> $A$ before $B$</li>
<li>these are just <em>ordering</em> dependencies:
<ul>
<li>so specifying $B$ <code>After</code> $A$ $\not\implies$ $A$ <code>Requires</code> $B$</li>
<li>so $B$ is started <em>even if</em> $A$ fails to start</li>
</ul>
</li>
<li>used to <em>control</em> the <em>order</em> in which units are started</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="about-dependencies-pt-2">About dependencies (pt. 2)</h2>
<ol start="4">
<li>
<p><strong>Conflict</strong>: $A$ <code>Conflicts</code> $B$ indicates that $A$ and $B$ <em>cannot</em> be <em>active</em> at the <em>same time</em></p>
<ul>
<li>if $A$ has a conflict with $B$ and you start $A$ while $B$ is running, <code>systemd</code> will <em>stop</em> $B$ before starting $A$</li>
<li>useful for <em>mutually exclusive</em> services</li>
<li>$A$ <code>Conflicts</code> $B$ $\implies$ $B$ <code>Conflicts</code> $A$</li>
</ul>
</li>
<li>
<p><strong>Binding</strong>: $A$ <code>BindsTo</code> $B$ (or $B$ <code>BoundBy</code> $A$) indicates that $A$ is <em>tightly bound</em> to $B$</p>
<ul>
<li>if $B$ stops or fails, $A$ will also stop</li>
<li>used for <em>stronger</em> dependencies than <code>Requires</code></li>
</ul>
</li>
<li>
<p>other sorts of dependencies are available, see the <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html">official doc</a></p>
</li>
</ol>
</section><section>
<h2 id="timer-activation">Timer activation</h2>
<ul>
<li>
<p>Some units‚Äô activation may be bound to <strong>time</strong></p>
<ul>
<li>e.g. <strong>at</strong> a given <em>date/time</em> in the future</li>
<li>e.g. on a <strong>recurring</strong> basis (e.g., <em>hourly</em>, <em>daily</em>, <em>weekly</em>, <em>monthly</em>, <em>yearly</em>, etc.)</li>
<li>e.g. after a <strong>relative amount</strong> of <em>time</em> has <em>elapsed</em> since:
<ul>
<li>the system was <em>booted</em></li>
<li><code>systemd</code> was <em>started</em></li>
<li>some unit was <em>(de)activated</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>To support <strong>timer activation</strong>, a <em>$U$</em> unit file should have a <em>corresponding</em> <code>.timer</code> unit file</p>
<ul>
<li>describing when <em>$U$</em> should be <em>activated</em></li>
<li>and <em>if/when</em> the activation of <em>$U$</em> should be <em>repeated</em></li>
<li>most commonly, the timer unit is named <em>$U$</em><code>.timer</code></li>
</ul>
</li>
<li>
<p>The timer is said to <strong>‚Äúelapse‚Äù</strong> (one or more times): the effect of an elapsing timer is to <em>activate</em> its <em>associated unit</em></p>
</li>
</ul>
</section><section>
<h2 id="unit-files-pt-5">Unit Files (pt. 5)</h2>
<h3 id="syntax-of-timer-unit-files-12">Syntax of <code>.timer</code> unit files (1/2)</h3>
<br>
<ul>
<li>In <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.timer.html">section <code>[Timer]</code></a>,
one should write information about the <strong>timer</strong> unit
<ul>
<li><code>Unit=</code> specifies the <em>unit</em> that should be <em>activated</em> when the timer <em>elapses</em></li>
<li><code>OnCalendar=</code> specifies the <em>date/time</em> when the timer should <em>activate</em>
<ul>
<li>the argument is a <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.time.html#Calendar%20Events">calendar event</a></li>
</ul>
</li>
<li><code>OnActiveSec=</code>, <code>OnBootSec=</code>, <code>OnStartupSec=</code>, <code>OnUnitActiveSec=</code>, <code>OnUnitInactiveSec=</code> specifies the <em>relative time</em> when the timer should <em>activate</em>,
respectively w.r.t. the <em>timer‚Äôs activation</em>, the system <em>boot</em>, <code>systemd</code> activation, the unit‚Äôs <em>(de)activation</em>
<ul>
<li>the argument is a <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.time.html#Parsing%20Time%20Spans">time span</a></li>
</ul>
</li>
<li><code>Persistent=</code> controls whether the timer should be <em>persistent</em> (i.e., <em>saved</em> across reboots)
<ol>
<li>if <em>true</em>, the time when the service unit was last triggered is <em>stored on disk</em></li>
<li>when the timer is activated, the service unit is triggered <em>immediately</em> if it would have been triggered <em>at least once</em> <strong>while</strong> being <strong>inactive</strong></li>
</ol>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="unit-files-pt-5-1">Unit Files (pt. 5)</h2>
<h3 id="syntax-of-timer-unit-files-22">Syntax of <code>.timer</code> unit files (2/2)</h3>
<br>
<ul>
<li>
<p>Examples of _<em>calendar events</em> (also good for <em>periodic</em> activation):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>    minutely ‚Üí *-*-* *:*:00
</span></span><span style="display:flex;"><span>      hourly ‚Üí *-*-* *:00:00
</span></span><span style="display:flex;"><span>       daily ‚Üí *-*-* 00:00:00
</span></span><span style="display:flex;"><span>     monthly ‚Üí *-*-01 00:00:00
</span></span><span style="display:flex;"><span>      weekly ‚Üí Mon *-*-* 00:00:00
</span></span><span style="display:flex;"><span>      yearly ‚Üí *-01-01 00:00:00
</span></span><span style="display:flex;"><span>   quarterly ‚Üí *-01,04,07,10-01 00:00:00
</span></span><span style="display:flex;"><span>semiannually ‚Üí *-01,07-01 00:00:00
</span></span><span style="display:flex;"><span>every 15mins ‚Üí *-*-* *:00,15,30,45:00    or    *-*-* *:00/15:*
</span></span></code></pre></div></li>
<li>
<p>Examples of <strong>time spans</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>2 h
</span></span><span style="display:flex;"><span>2hours
</span></span><span style="display:flex;"><span>48hr
</span></span><span style="display:flex;"><span>1y 12month
</span></span><span style="display:flex;"><span>55s500ms
</span></span><span style="display:flex;"><span>300ms20s 5day
</span></span></code></pre></div></li>
</ul>
</section><section>


<section data-shortcode-section="">
<h2 id="running-exercise-duckdns-timer-pt-1">Running Exercise: DuckDNS timer (pt. 1)</h2>
<ul>
<li><a href="https://www.duckdns.org">DuckDNS</a> is a free online service aimed at registering <em>custom DNS entries</em>
<ul>
<li>e.g., <code>CUSTOM.duckdns.org</code> can be <em>mapped</em> to your computer‚Äôs <em>IP address</em></li>
<li>this is useful for <em>remote access</em> to your <em>home network</em> (e.g., via <em>SSH</em>)</li>
</ul>
</li>
</ul>
<p><img src="./duckdns.png" alt=""></p>
</section><section>
<h2 id="running-exercise-duckdns-timer-pt-2">Running Exercise: DuckDNS timer (pt. 2)</h2>
<blockquote>
<p><strong>Problem</strong>: most commonly, your <em>home network</em> has a <em>dynamic IP address</em></p>
</blockquote>
<span class="fragment ">
  <blockquote>
<p><strong>Solution</strong>: you can <em>periodically</em> update your <em>DNS entry</em> with your <em>current IP address</em></p>
</blockquote>
</span>
<span class="fragment ">
  <h3 id="updating-the-duckdns-entry-programmatically">Updating the DuckDNS entry programmatically</h3>
<ol>
<li>
<p>Simply perform an HTTP <code>GET</code> request to <a href="https://www.duckdns.org/update?domains=CUSTOM&amp;token=TOKEN&amp;ip=IP">https://www.duckdns.org/update?domains=CUSTOM&amp;token=TOKEN&amp;ip=IP</a> (e.g. via <code>curl</code>)</p>
<ul>
<li>where <code>CUSTOM</code> is your <em>custom domain</em>,</li>
<li><code>TOKEN</code> is the authentication <em>token</em>,</li>
<li>and <code>IP</code> is your <em>current IP address</em> (could be <em>empty</em>, to use the <em>source IP</em>)</li>
</ul>
</li>
<li>
<p>response shall be <code>OK</code> if the update was successful, <code>KO</code> otherwise</p>
</li>
</ol>
</span>
</section><section>
<h2 id="running-exercise-duckdns-timer-pt-3">Running Exercise: DuckDNS timer (pt. 3)</h2>
<ol>
<li>
<p>Let‚Äôs create a file containing the <em>default configuration</em> for the DuckDNS service,
<br> via <code>sudo mkdir -p /etc/duckdns.d ; sudo nano /etc/duckdns.d/default.cfg</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>DUCKDNS_HOSTNAME=
</span></span><span style="display:flex;"><span>DUCKDNS_TOKEN=
</span></span></code></pre></div></li>
<li>
<p>Let‚Äôs <em>create</em> a script for updating the DuckDNS entry, via <code>sudo nano /usr/bin/duckdns</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>logger -t DuckDNS <span style="color:#4e9a06">"Updating DuckDNS entries"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">EXITCODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> file in /etc/duckdns.d/*.cfg<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    . <span style="color:#4e9a06">"</span><span style="color:#4e9a06">${</span><span style="color:#000">file</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">"</span>
</span></span><span style="display:flex;"><span>    logger -t DuckDNS <span style="color:#4e9a06">"Executing config file '</span><span style="color:#4e9a06">${</span><span style="color:#000">file</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">'"</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">OUTPUT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>curl --silent <span style="color:#4e9a06">"https://www.duckdns.org/update?domains=</span><span style="color:#4e9a06">${</span><span style="color:#000">DUCKDNS_HOSTNAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&amp;token=</span><span style="color:#4e9a06">${</span><span style="color:#000">DUCKDNS_TOKEN</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&amp;ip="</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    logger -t DuckDNS <span style="color:#4e9a06">${</span><span style="color:#000">OUTPUT</span><span style="color:#4e9a06">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#4e9a06">"</span><span style="color:#4e9a06">${</span><span style="color:#000">OUTPUT</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">"</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">"KO"</span> <span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>        logger -t DuckDNS <span style="color:#4e9a06">"You should check if your domain/token is correct because the server responded negatively!"</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">EXITCODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">exit</span> <span style="color:#000">$EXITCODE</span>
</span></span></code></pre></div><ul>
<li>this requires the <code>curl</code> package to be installed</li>
</ul>
</li>
<li>
<p>Let‚Äôs make the script <em>executable</em> by anyone, via <code>sudo chmod a+x /usr/bin/duckdns</code></p>
</li>
<li>
<p>Let‚Äôs <em>test</em> the script by running <code>duckdns</code> command (<strong>no logs?</strong> try <code>cat /var/log/syslog | grep DuckDNS</code>)</p>
</li>
</ol>
</section><section>
<h2 id="running-exercise-duckdns-timer-pt-4">Running Exercise: DuckDNS timer (pt. 4)</h2>
<ol start="5">
<li>
<p>Let‚Äôs create a <code>.service</code> unit file for the DuckDNS <em>service</em>, via <code>sudo nano /etc/systemd/system/duckdns.service</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">DuckDNS update job</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">multi-user.target</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">oneshot</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">/usr/bin/duckdns</span>
</span></span></code></pre></div></li>
<li>
<p>Let‚Äôs create a <code>.timer</code> unit file for the DuckDNS <em>timer</em>, via <code>sudo nano /etc/systemd/system/duckdns.timer</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">Run DuckDNS periodically</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Timer]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">OnCalendar</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">*-*-* *:00/15:*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#c4a000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">timers.target</span>
</span></span></code></pre></div></li>
<li>
<p>Let‚Äôs <em>enable</em> and <em>start</em> the DuckDNS <em>service</em> and <em>timer</em>, via <code>sudo systemctl enable --now duckdns.service duckdns.timer</code></p>
</li>
<li>
<p><strong>How do we check if the DuckDNS service is working?</strong></p>
</li>
</ol>

</section>
</section><section>
<h2 id="systemd-journal-and-logging-pt-1">Systemd, Journal, and Logging (pt. 1)</h2>
<ul>
<li>
<p><code>systemd</code> is <em>integrated</em> with the <em>system log</em> (a.k.a. <em>journal</em>)</p>
<ul>
<li>the <em>journal</em> is a <em>structured</em> and <em>indexed</em> <em>log</em> of <em>system events</em></li>
<li>it is <em>stored</em> in <code>/var/log/journal/</code> and <em>managed</em> by <code>journald</code> (a daemon which is part of the <code>systemd</code> suite)</li>
<li>the <em>journal</em> is <strong>persistent</strong> across <em>reboots</em></li>
</ul>
</li>
<li>
<p><strong>Logs</strong> produced by <code>systemd</code>‚Äôs <em>units</em> are <em>forwarded</em> to the <em>journal</em></p>
<ul>
<li>you can <em>inspect</em> the <em>journal</em> via <code>journalctl</code> command
<ul>
<li>the <em>journal</em> is <strong>page</strong>: use <em>arrow keys</em> to <em>navigate</em>, <em>Q</em> to <em>quit</em></li>
</ul>
</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="systemd-journal-and-logging-pt-2">Systemd, Journal, and Logging (pt. 2)</h2>
<ul>
<li>
<p>Useful options of <code>journalctl</code> for <strong>inspecting</strong> the logs:</p>
<ul>
<li><code>journalctl</code> get <em>all</em> logs, from the <em>oldest</em> to the <em>newest</em></li>
<li><code>journalctl -u NAME.TYPE</code> to <em>filter</em> logs for a <em>specific unit</em></li>
<li><code>journalctl -b</code> to <em>filter</em> logs for the <em>current boot</em>
<ul>
<li><code>journalctl -b -1</code> for the <em>previous boot</em>, <code>journalctl -b -2</code> for the <em>boot before that</em>, etc.</li>
</ul>
</li>
<li><code>journalctl -f</code> to <em>follow</em> the <em>live</em> logs</li>
<li><code>journalctl -n N</code> to <em>show</em> the <em>last N</em> log entries</li>
<li><code>journalctl -e</code> to jump to the <em>end</em> of the logs</li>
<li><code>journalctl --since "2024-11-11 11:09:51" --until "2024-11-11 11:10:51"</code> to <em>filter</em> logs for a <em>specific time range</em></li>
<li><code>journalctl -g PATTERN</code> to <em>filter</em> logs matching a <em>specific pattern</em> (cf. the <code>grep</code> command)</li>
<li><code>journalctl -x</code> to <em>show</em> message <em>explanations</em> (e.g., <em>systemd</em> messages) where available</li>
<li>see other options with <code>man journalctl</code> or <code>journalctl --help</code></li>
</ul>
</li>
<li>
<p>Notice that the options can be <strong>combined</strong>:</p>
<ul>
<li>e.g., <code>journalctl -u ssh.service -b -n 10</code> $\rightarrow$ <em>show</em> the <em>last 10</em> logs for the <em>SSH daemon</em> unit in the <em>current boot</em></li>
<li>e.g., <code>journalctl -exu ssh.service</code> $\rightarrow$ <em>show</em> the <em>last</em> logs for the <em>SSH daemon</em> unit, with <em>explanations</em></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="systemd-journal-and-logging-pt-3">Systemd, Journal, and Logging (pt. 3)</h2>
<ul>
<li>
<p>Being persistent, logs take up <em>disk space</em></p>
<ul>
<li><code>journalctl --disk-usage</code> to <em>show</em> the <em>disk usage</em> of the <em>journal</em></li>
</ul>
</li>
<li>
<p>Useful options of <code>journalctl</code> for <strong>managing</strong> the logs:</p>
<ul>
<li><code>journalctl --vacuum-size=SIZE</code> to <em>limit</em> the <em>disk space</em> used by the <em>journal</em></li>
<li><code>journalctl --vacuum-time=TIME</code> to <em>limit</em> the <em>time</em> for which logs are <em>retained</em> (by <strong>erasing</strong> <em>older</em> logs)</li>
<li><code>journalctl --rotate</code> to <em>rotate</em> the <em>journal</em> (i.e., <em>archive</em> the <em>current</em> journal and <em>start</em> a <em>new</em> one)</li>
</ul>
</li>
</ul>
</section><section>


<section data-shortcode-section="">
<h2 id="running-exercise-duckdns-timer-pt-5">Running Exercise: DuckDNS timer (pt. 5)</h2>
<ol start="9">
<li>Let‚Äôs <em>inspect</em> the logs of the DuckDNS service, via <code>journalctl -fexu duckdns.service</code>
<ul>
<li>you should see the <em>logs</em> of the <em>DuckDNS service</em> being <em>executed</em> every <em>15 minutes</em></li>
</ul>
</li>
</ol>
<pre tabindex="0"><code class="nohighlight" data-noescape="">nov 13 18:35:45 lubuntu2410-vm systemd[1]: Starting duckdns.service - DuckDNS update job...
‚ñë‚ñë Subject: L'unit√† duckdns.service inizia la fase di avvio
‚ñë‚ñë Defined-By: systemd
‚ñë‚ñë Support: http://www.ubuntu.com/support
‚ñë‚ñë
‚ñë‚ñë L'unit√† duckdns.service ha iniziato la fase di avvio.
nov 13 18:35:45 lubuntu2410-vm DuckDNS[3548]: Updating DuckDNS entries
nov 13 18:35:45 lubuntu2410-vm DuckDNS[3549]: Executing config file '/etc/duckdns.d/default.cfg'
nov 13 18:35:46 lubuntu2410-vm DuckDNS[3552]: KO
nov 13 18:35:46 lubuntu2410-vm systemd[1]: duckdns.service: Main process exited, code=exited, statu&gt;
‚ñë‚ñë Subject: Uscito processo unit√†
‚ñë‚ñë Defined-By: systemd
‚ñë‚ñë Support: http://www.ubuntu.com/support
‚ñë‚ñë
‚ñë‚ñë Un processo ExecStart appartenente all'unit√† duckdns.service √® uscito.
‚ñë‚ñë
‚ñë‚ñë Il codice di uscita del processo √® 'exited' ed √® uscito con 1.
nov 13 18:35:46 lubuntu2410-vm systemd[1]: duckdns.service: Failed with result 'exit-code'.
‚ñë‚ñë Subject: Unit fallita
‚ñë‚ñë Defined-By: systemd
‚ñë‚ñë Support: http://www.ubuntu.com/support
‚ñë‚ñë
‚ñë‚ñë Unit√† duckdns.service entrata nello stato 'failed' (fallito) con risultato 'exit-code'.
nov 13 18:35:46 lubuntu2410-vm systemd[1]: Failed to start duckdns.service - DuckDNS update job.
‚ñë‚ñë Subject: L'unit√† duckdns.service √® fallita
‚ñë‚ñë Defined-By: systemd
‚ñë‚ñë Support: http://www.ubuntu.com/support
‚ñë‚ñë
‚ñë‚ñë L'unit√† duckdns.service √® fallita.
‚ñë‚ñë
‚ñë‚ñë Il risultato √® failed.
</code></pre></section><section>
<h2 id="running-exercise-duckdns-timer-pt-6">Running Exercise: DuckDNS timer (pt. 6)</h2>
<ol start="10">
<li>
<p>The issue here is that we did not the necessary information <code>/etc/duckdns.d/default.cfg</code></p>
</li>
<li>
<p>Try to fill that file with the correct information, via <code>sudo nano /etc/duckdns.d/default.cfg</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>DUCKDNS_HOSTNAME=your-custom-domain
</span></span><span style="display:flex;"><span>DUCKDNS_TOKEN=your-authentication-token
</span></span></code></pre></div></li>
<li>
<p>Let‚Äôs <em>restart</em> the DuckDNS service, via <code>sudo systemctl restart duckdns.service</code></p>
</li>
<li>
<p>Let‚Äôs look at the logs again to see if the DuckDNS service is working</p>
</li>
</ol>

</section>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/course-scm-linux-advanced/reveal-hugo/object-assign.js"></script>

<a href="/course-scm-linux-advanced/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"solarized-dark","history":true,"mermaid":[{}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">{"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"}}</script>

<script src="/course-scm-linux-advanced/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/course-scm-linux-advanced/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/course-scm-linux-advanced/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/course-scm-linux-advanced/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/course-scm-linux-advanced/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/course-scm-linux-advanced/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  

  
  

  
  

  
  





    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>